# All plot configurations in this file are tested.
#
# Supports `_raises` and `_match` keys but not `based_on` entries that refer to
# entries within this file!
---
# NOTE These need to be passed via YAML anchors (instead of based_on) because
#      in the test context not all information may be available in the pool.
.uni_defaults: &uni_defaults
  based_on:
    - .creator.universe
    - .plot.facet_grid

  x: time

.mv_defaults: &mv_defaults
  based_on:
    - .creator.multiverse
    - .plot.facet_grid

  x: time

.sns_shared: &sns_shared
  based_on:
    - .creator.universe
    - .plot.snsplot

  select:
    data:
      path: mean_state
      transform:
        - .data
        - print

# -- Basics -------------------------------------------------------------------

uni_ts:
  <<: *uni_defaults
  select:
    data:
      path: state
      with_previous_result: true
      transform:
        - .mean: {dim: state_idx}

mv_ts:
  <<: *mv_defaults
  select_and_combine:
    base_path: data/ExtendedModel
    fields:
      data:
        path: state
        with_previous_result: true
        transform:
          - .mean: {dim: state_idx}

uni_custom_operation:
  <<: *uni_defaults
  select:
    data:
      path: state
      transform:
        - my_custom_data_operation: [!dag_prev ]
        - getattr: [!dag_prev , data]


# -- CA plot ------------------------------------------------------------------
# ... the old one needs tests as well

ca_legacy:
  based_on:
    - .ca.state.anim_frames

  model_name: ExtendedModel

  to_plot:
    ca:
      title: CA state



# -- seaborn plots ------------------------------------------------------------

sns_kinds:
  <<: *sns_shared

  from_pspace:
    sns_kind: !sweep
      default: relplot
      values:
        - relplot
        - displot
        - catplot
        - lmplot
        - pairplot
        - jointplot
        # - clustermap  # not possible with the available data

  free_indices: [mean_state]

sns_dropna_sample:
  <<: *sns_shared

  select:
    data:
      path: state
      transform:
        - .data
        - print

  sns_kind: relplot
  free_indices: [state_idx]
  reset_index: true
  dropna: true
  sample: 1000


sns_fail:
  <<: *sns_shared

  _raises: PlotCreatorError

  select:
    data:
      path: state
      transform:
        - .data

  sns_kind: relplot
  free_indices: [state_idx]
  dropna: true
  sample: 1000
