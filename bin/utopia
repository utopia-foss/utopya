#!/usr/bin/env python3
"""This is the command line interface for Utopia"""

import sys
import argparse
import warnings

import utopya

# -----------------------------------------------------------------------------
if __name__ == '__main__':
    # Define the CLI
    parser = argparse.ArgumentParser(description='Perform a Utopia run.',
                                     epilog="And that's how you use utopia.")
    parser.add_argument('model_name',
                        help="The name of the model to run")
    parser.add_argument('run_cfg_path',
                        default=None, nargs='?',
                        help="The path to the run configuration. Needs to be "
                             "given unless --no-run-cfg is also set.")
    parser.add_argument('-s', '--single',
                        default=None, action='store_true',
                        help="If given, forces a single simulation.")
    parser.add_argument('-p', '--sweep',
                        default=None, action='store_true',
                        help="If given, forces a parameter sweep. Is ignored, "
                             "if the --single argument was also given.")
    parser.add_argument('--no-run-cfg',
                        dest='no_run_cfg',
                        default=False, action='store_true',
                        help="If given, it is allowd to omit the "
                             "`run_cfg_path` argument.")
    parser.add_argument('-v', '--verbose',
                        default=0, action='count',
                        help="(UNSUPPORTED) Sets the verbosity level of the "
                             "frontend.")

    # CLI defined. Parse the arguments now.
    args = parser.parse_args()

    # Check the arguments
    if args.no_run_cfg is False and args.run_cfg_path is None:
        print("No positional argument `run_cfg_path` given!\n"
              "If it should be omitted, add the --no-run-cfg flag.\n")
        parser.print_help()
        sys.exit()

    # Using the args, instantiate a Multiverse object
    mv = utopya.Multiverse(model_name=args.model_name,
                           run_cfg_path=args.run_cfg_path)

    if args.single:
        if args.sweep:
            warnings.warn("Received both --single and --sweep arguments; will "
                          "perform a single simulation.",
                          UserWarning)

        mv.run_single()

    elif args.sweep:
        mv.run_sweep()

    else:
        mv.run()
        
